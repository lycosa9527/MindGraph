# Example .env file for MindGraph
# FastAPI App
HOST=0.0.0.0
PORT=9527
DEBUG=False

# External Access Configuration
# EXTERNAL_HOST=your-public-ip-address  # Optional: Set your public WAN IP for external access
# If not set, the system will automatically detect your WAN IP
# Qwen API (Required - for core application functionality)
QWEN_API_KEY=your-qwen-api-key-here
QWEN_API_URL=https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions

# Model Selection Strategy:
# - qwen-turbo: For classification tasks (faster, cheaper, 3.59s → 1.5s)
# - qwen-plus: For generation tasks (higher quality, 17.45s → 12s)
# Note: Qwen3 models automatically disable thinking feature (enable_thinking: False)
# to avoid API errors when not using streaming
QWEN_MODEL_CLASSIFICATION=qwen-turbo
QWEN_MODEL_GENERATION=qwen-plus
QWEN_TEMPERATURE=0.7
QWEN_MAX_TOKENS=1000
QWEN_TIMEOUT=40

# Unified temperature for all diagram generation agents
# Lower values (0.1-0.3) = more consistent, structured output (best for JSON)
# Higher values (0.7-1.0) = more creative, varied output
LLM_TEMPERATURE=0.3

# Tencent Hunyuan API (Optional - For Hunyuan/混元 LLM)
# Register at: https://cloud.tencent.com/product/hunyuan
# Note: Hunyuan requires Temperature ≤ 2.0 (API constraint)
HUNYUAN_API_KEY=your-hunyuan-secretkey-here
HUNYUAN_SECRET_ID=your-hunyuan-secretid-here
HUNYUAN_API_URL=https://hunyuan.tencentcloudapi.com
HUNYUAN_MODEL=hunyuan-turbo
HUNYUAN_TEMPERATURE=1.0
HUNYUAN_MAX_TOKENS=2000

# ============================================================================
# DASHSCOPE PLATFORM RATE LIMITING (For Multi-LLM Parallel Calls)
# ============================================================================
# When calling multiple LLMs (Qwen, DeepSeek, Kimi) in parallel via Dashscope,
# you share QPM (Queries Per Minute) and concurrent request limits across all models.
# Configure based on your Dashscope account tier.

# Queries Per Minute limit (total across all models)
# - Free tier: 60 QPM
# - Standard tier: 300 QPM
# - Enterprise tier: Custom (check your account)
DASHSCOPE_QPM_LIMIT=1000

# Maximum concurrent requests (total across all models)
# - Free tier: 10 concurrent
# - Standard tier: 50+ concurrent
# - Enterprise tier: Custom
DASHSCOPE_CONCURRENT_LIMIT=500

# Enable/disable rate limiting (set 'false' only for testing)
DASHSCOPE_RATE_LIMITING_ENABLED=true

# Graph Language
GRAPH_LANGUAGE=zh

# Default UI Language (en/zh/az)
# - en: English
# - zh: Chinese (中文)
# - az: Azerbaijani (Azərbaycan)
# Controls the default language shown in the UI on first load
# Users can still toggle between languages using the language button
DEFAULT_LANGUAGE=zh

# UI/Graph Styling (optional)
TOPIC_FONT_SIZE=18
CHAR_FONT_SIZE=14
# Watermark (optional)
WATERMARK_TEXT=MindGraph

# Logging Configuration (optional)
# Available levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Default: INFO
LOG_LEVEL=INFO

# Verbose Logging - Enable detailed logging for debugging
# When enabled, logs EVERY user interaction (mouse clicks, text edits, node selections, drag events)
# Also enables verbose backend agent logging
# Set to True for development/debugging, False for production
# Default: False
VERBOSE_LOGGING=False

# ==============================================
# FEATURE FLAGS (Development/Testing)
# ==============================================
# Enable experimental features (set to True to show buttons)
# These features are still in development and may change

# Learning Mode - Interactive learning worksheet generation
FEATURE_LEARNING_MODE=False
# ThinkGuide - Socratic guided thinking mode
FEATURE_THINKGUIDE=False
# MindMate AI Assistant - Canvas side panel AI assistant
FEATURE_MINDMATE=False
# Voice Agent - Real-time voice conversation with Qwen Omni
FEATURE_VOICE_AGENT=False

# DIFY AI ASSISTANT CONFIGURATION (Optional - For Canvas AI Assistant)
# Dify API key for AI assistant in Canvas side panel
DIFY_API_KEY=your_dify_api_key_here

# Dify API URL
DIFY_API_URL=http://101.42.231.179/v1

# Dify request timeout in seconds
DIFY_TIMEOUT=30

# AI Assistant Display Name (Customizable branding)
# This name appears in the toolbar button and AI panel header
# Default: MindMate AI
AI_ASSISTANT_NAME=MindMate AI

# ============================================================================
# AUTHENTICATION & SECURITY CONFIGURATION
# ============================================================================

# Database Configuration
DATABASE_URL=sqlite:///./data/mindgraph.db

# ============================================================================
# DATABASE BACKUP CONFIGURATION
# ============================================================================
# Automatic daily backup of SQLite database with rotation
# Backups are stored in the backup/ directory by default

# Enable/disable automatic backups (default: true)
BACKUP_ENABLED=true

# Hour to run daily backup (0-23, default: 3 = 3:00 AM)
BACKUP_HOUR=3

# Number of backup files to keep (default: 2)
# Uses count-based retention - keeps N most recent backups
BACKUP_RETENTION_COUNT=2

# Backup directory (default: backup/)
BACKUP_DIR=backup

# JWT Configuration
# IMPORTANT: Generate a new secure key for production using:
#   python -c "import secrets; print(secrets.token_urlsafe(48))"
# Minimum 32 characters required, 64+ recommended
JWT_SECRET_KEY=QwWZfgwi-ct3rBdWyhoXa7S5mzHuC6yaGgmzGC_-1qSMl4H-879Ng4jZIq1cBSR7
JWT_EXPIRY_HOURS=24

# Authentication Mode (standard, enterprise, demo, bayi)
# - standard: Full registration/login with captcha
# - enterprise: No auth (for VPN/SSO deployments)
# - demo: 6-digit passkey for presentations
# - bayi: Token-based authentication via /loginByXz endpoint (for Bayi School)
AUTH_MODE=standard

# Admin Phone Numbers (comma-separated)
# First user should be admin - register normally, then add phone here
# Include "demo-admin@system.com" to allow admin demo access
# Example: ADMIN_PHONES=13800000000,13900000000,demo-admin@system.com
ADMIN_PHONES=demo-admin@system.com

# Enterprise Mode Configuration (only if AUTH_MODE=enterprise)
ENTERPRISE_DEFAULT_ORG_CODE=DEMO-001
ENTERPRISE_DEFAULT_USER_PHONE=enterprise@system.com

# Demo Mode Configuration (only if AUTH_MODE=demo)
# Set a 6-digit passkey for demo access
DEMO_PASSKEY=888888

# Admin Demo Passkey - separate passkey for admin access via demo mode
# Admins can use this to access /admin panel in demo mode
ADMIN_DEMO_PASSKEY=999999

# Bayi Mode Configuration (only if AUTH_MODE=bayi)
# Decryption key for bayi token authentication (provided by xiaozhi)
BAYI_DECRYPTION_KEY=v8IT7XujLPsM7FYuDPRhPtZk
# Default organization code for bayi mode users
BAYI_DEFAULT_ORG_CODE=BAYI-001
# Bayi IP Whitelist (optional)
# If configured, teachers from these IPs can skip token verification completely
# Format: Comma-separated list of IP addresses
# Example: BAYI_IP_WHITELIST=202.120.1.5,202.120.1.6,202.120.1.7
# If not set, all authentication requires token (current behavior)
# Note: IPs are checked first; if whitelisted, token is not required and access is granted immediately
BAYI_IP_WHITELIST=

# ============================================================================
# TENCENT CLOUD SMS CONFIGURATION (Optional)
# ============================================================================
# SMS verification for registration, login, and password reset
# Register at: https://console.cloud.tencent.com/smsv2
# Documentation: https://cloud.tencent.com/document/product/382

# Tencent Cloud API credentials
# Get from: https://console.cloud.tencent.com/cam/capi
TENCENT_SMS_SECRET_ID=your-tencent-secret-id-here
TENCENT_SMS_SECRET_KEY=your-tencent-secret-key-here

# SMS SDK Application ID
# Get from: https://console.cloud.tencent.com/smsv2/app-manage
TENCENT_SMS_SDK_APP_ID=1400000000

# SMS Signature Name (must be approved in console)
# Get from: https://console.cloud.tencent.com/smsv2/csms-sign
TENCENT_SMS_SIGN_NAME=MindGraph

# SMS Region (default: ap-guangzhou)
# Options: ap-guangzhou, ap-beijing, ap-shanghai, etc.
TENCENT_SMS_REGION=ap-guangzhou

# SMS Template IDs (must be approved in Tencent console)
# Get from: https://console.cloud.tencent.com/smsv2/csms-template
# Each template must be created and approved separately in Tencent console.
# Template variables: {1} = verification code, {2} = expiry minutes
#
# Example template content for each purpose:
# - Register: "Your registration verification code is {1}, valid for {2} minutes. Do not share with anyone."
# - Login: "Your login verification code is {1}, valid for {2} minutes. If this was not you, please ignore."
# - Reset Password: "Your password reset code is {1}, valid for {2} minutes. If you did not request this, please ignore."
#
TENCENT_SMS_TEMPLATE_REGISTER=1234567
TENCENT_SMS_TEMPLATE_LOGIN=1234568
TENCENT_SMS_TEMPLATE_RESET_PASSWORD=1234569

# SMS Rate Limiting Configuration
# Verification code expiry time in minutes (default: 5)
SMS_CODE_EXPIRY_MINUTES=5
# Minimum interval between SMS requests in seconds (default: 60)
SMS_RESEND_INTERVAL_SECONDS=60
# Maximum SMS requests per phone within the time window (default: 5)
SMS_MAX_ATTEMPTS_PER_PHONE=5
# Time window for rate limiting in hours (default: 1)
SMS_MAX_ATTEMPTS_WINDOW_HOURS=1

# Invitation Codes with Expiry (for controlled registration)
# Format: ORG_CODE:INVITATION_CODE:EXPIRY_DATE
# Expiry format: YYYY-MM-DD or "never"
# Example: DEMO-001:DEMO2024:2025-12-31,SPRING-EDU:SPRING123:never
INVITATION_CODES=DEMO-001:DEMO2024:2025-12-31,SPRING-EDU:SPRING123:never,BJ-001:BJ-INVITE:2025-06-30,SH-042:SH2024:2025-12-31

# ============================================================================
# REVERSE PROXY CONFIGURATION (Nginx, Caddy, etc.)
# ============================================================================
# When using a reverse proxy (Nginx Proxy Manager, Caddy, Traefik, etc.),
# the application must read the real client IP from proxy headers to correctly
# enforce rate limiting and prevent captcha lockouts.
#
# IMPORTANT: Nginx Proxy Manager Configuration
# --------------------------------------------
# In Nginx Proxy Manager, ensure you have the following in your proxy host settings:
# 1. Advanced > Custom Nginx Configuration, add:
#
#    proxy_set_header X-Real-IP $remote_addr;
#    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#    proxy_set_header X-Forwarded-Proto $scheme;
#
# 2. If using Cloudflare or another CDN in front of nginx, you may also need:
#
#    set_real_ip_from 0.0.0.0/0;  # Or specific Cloudflare IP ranges
#    real_ip_header X-Forwarded-For;
#
# The application automatically reads client IPs from these headers:
# - X-Forwarded-For (takes leftmost IP = original client)
# - X-Real-IP (nginx-specific)
# - Falls back to direct connection IP if no headers present
#
# Optional: Restrict which proxy IPs are trusted (comma-separated)
# Leave empty to trust all proxies (recommended for most deployments)
# TRUSTED_PROXY_IPS=10.0.0.1,192.168.1.100

# ============================================================================
# Qwen Omni Realtime (Voice Agent)
# ============================================================================
QWEN_OMNI_MODEL=qwen3-omni-flash-realtime
QWEN_OMNI_VOICE=Cherry
QWEN_OMNI_VAD_THRESHOLD=0.5
QWEN_OMNI_VAD_SILENCE_MS=800
QWEN_OMNI_VAD_PREFIX_MS=300
QWEN_OMNI_SMOOTH_OUTPUT=true
QWEN_OMNI_INPUT_FORMAT=pcm16
QWEN_OMNI_OUTPUT_FORMAT=pcm24
QWEN_OMNI_TRANSCRIPTION_MODEL=gummy-realtime-v1

# ============================================================================
# FEEDBACK EMAIL SERVICE (Optional)
# ============================================================================
# Resend API - Simple email service without SMTP setup
# Sign up at: https://resend.com (Free tier: 100 emails/day)
# Get API key from: https://resend.com/api-keys
RESEND_API_KEY=re_your_resend_api_key_here
RESEND_FROM_EMAIL=MindGraph <feedback@mindspringedu.cn>

# ============================================================================
# WECHAT QR CODE CONFIGURATION
# ============================================================================
# WeChat group QR code image filename (stored in static/qr/ folder)
# Example: WECHAT_QR_IMAGE=wechat-group-qr.png
# If not set, feedback button will be hidden
WECHAT_QR_IMAGE=