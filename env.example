# ============================================================================
# MINDPHASE ENVIRONMENT CONFIGURATION
# ============================================================================
# Copy this file to .env and configure according to your deployment needs

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
HOST=0.0.0.0
PORT=9527
DEBUG=False

# Optional: Set your public WAN IP for external access (auto-detected if not set)
# EXTERNAL_HOST=your-public-ip-address

# Optional: Full base URL for external access (takes precedence over EXTERNAL_HOST)
# Use this when behind a reverse proxy with HTTPS (e.g. Nginx Proxy Manager)
# Example: https://your-domain.com (no trailing slash)
# EXTERNAL_BASE_URL=https://your-domain.com

# ============================================================================
# LLM MODELS CONFIGURATION
# ============================================================================

QWEN_API_KEY=your-qwen-api-key-here
QWEN_API_URL=https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
QWEN_MODEL_CLASSIFICATION=qwen-plus-latest
QWEN_MODEL_GENERATION=qwen-plus-latest

DASHSCOPE_QPM_LIMIT=13500
DASHSCOPE_CONCURRENT_LIMIT=500
DASHSCOPE_RATE_LIMITING_ENABLED=false

ARK_API_KEY=your-ark-api-key-here
ARK_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
ARK_DEEPSEEK_ENDPOINT=ep-20250101000000-dummy
ARK_KIMI_ENDPOINT=ep-20250101000000-dummy
ARK_DOUBAO_ENDPOINT=ep-20250101000000-dummy

# Volcengine ARK Rate Limiting (Endpoint-Specific)
# Each endpoint has independent limits per Volcengine provider
# Official limits:
#   - ark-deepseek (v3.2): 15,000 RPM, 1,500,000 TPM
#   - ark-kimi: 5,000 RPM, 500,000 TPM
#   - ark-doubao: 30,000 RPM, 5,000,000 TPM
# Note: Each endpoint is tracked separately with endpoint-specific Redis keys
KIMI_VOLCENGINE_QPM_LIMIT=4500
KIMI_VOLCENGINE_CONCURRENT_LIMIT=500
DOUBAO_VOLCENGINE_QPM_LIMIT=27000
DOUBAO_VOLCENGINE_CONCURRENT_LIMIT=500

# Legacy ARK rate limiting (deprecated - use endpoint-specific limits above)
ARK_QPM_LIMIT=4500
ARK_CONCURRENT_LIMIT=500
ARK_RATE_LIMITING_ENABLED=false

# Load Balancing Configuration
LOAD_BALANCING_ENABLED=false
LOAD_BALANCING_STRATEGY=round_robin
LOAD_BALANCING_WEIGHTS=dashscope:50,volcengine:50

# Load Balancing Rate Limiting (for DeepSeek)
# DeepSeek is load-balanced between Dashscope and Volcengine
# Official Dashscope limits:
#   - deepseek-v3.1: 15,000 RPM, 1,200,000 TPM
#   - deepseek-v3.2: 15,000 RPM, 1,500,000 TPM
#   - deepseek-r1: 15,000 RPM, 1,200,000 TPM
# Volcengine ark-deepseek endpoint (v3.2): 15,000 RPM, 1,500,000 TPM (same as Dashscope)
LOAD_BALANCING_RATE_LIMITING_ENABLED=true

# DeepSeek Dashscope Route Rate Limits
# DEPRECATED: DeepSeek Dashscope route now uses shared DASHSCOPE_QPM_LIMIT (same as Qwen)
# This is because all Dashscope traffic (Qwen + DeepSeek Dashscope route) counts as one combined limit
# These settings are kept for backward compatibility but are NOT USED
# The shared Dashscope rate limiter handles both Qwen and DeepSeek Dashscope routes together
DEEPSEEK_DASHSCOPE_QPM_LIMIT=13500
DEEPSEEK_DASHSCOPE_CONCURRENT_LIMIT=500

# DeepSeek Volcengine Route Rate Limits
# These limits are used for the Volcengine route (ark-deepseek endpoint)
# Separate from Dashscope limits since Volcengine is a different provider
DEEPSEEK_VOLCENGINE_QPM_LIMIT=13500
DEEPSEEK_VOLCENGINE_CONCURRENT_LIMIT=500

HUNYUAN_API_KEY=your-hunyuan-secretkey-here
HUNYUAN_SECRET_ID=your-hunyuan-secretid-here
HUNYUAN_API_URL=https://hunyuan.tencentcloudapi.com
HUNYUAN_MODEL=hunyuan-turbo
DASHSCOPE_QPM_LIMIT=10000
DASHSCOPE_CONCURRENT_LIMIT=500
DASHSCOPE_RATE_LIMITING_ENABLED=false

ARK_API_KEY=your-ark-api-key-here
ARK_BASE_URL=https://ark.cn-beijing.volces.com/api/v3

ARK_DEEPSEEK_ENDPOINT=ep-20250101000000-dummy
ARK_KIMI_ENDPOINT=ep-20250101000000-dummy
ARK_DOUBAO_ENDPOINT=ep-20250101000000-dummy

# Rate Limiting (Optional)
ARK_QPM_LIMIT=5000
ARK_CONCURRENT_LIMIT=500
ARK_RATE_LIMITING_ENABLED=false

HUNYUAN_API_KEY=your-hunyuan-secretkey-here
HUNYUAN_SECRET_ID=your-hunyuan-secretid-here
HUNYUAN_API_URL=https://hunyuan.tencentcloudapi.com
HUNYUAN_MODEL=hunyuan-turbo

# ============================================================================
# LOAD BALANCING CONFIGURATION
# ============================================================================
# Distributes DeepSeek requests between Dashscope and Volcengine
# Only DeepSeek is load-balanced; Qwen always uses Dashscope; Kimi/Doubao always use Volcengine

LOAD_BALANCING_ENABLED=false
LOAD_BALANCING_STRATEGY=round_robin
LOAD_BALANCING_WEIGHTS=dashscope:50,volcengine:50

# ============================================================================
# UI & DISPLAY CONFIGURATION
# ============================================================================
GRAPH_LANGUAGE=zh
DEFAULT_LANGUAGE=zh
TOPIC_FONT_SIZE=18
CHAR_FONT_SIZE=14
WATERMARK_TEXT=MindGraph

# ============================================================================
# LOGGING & DEBUGGING
# ============================================================================
LOG_LEVEL=INFO
VERBOSE_LOGGING=False

# ============================================================================
# FEATURE FLAGS
# ============================================================================
FEATURE_MINDMATE=False
FEATURE_VOICE_AGENT=False
FEATURE_DRAG_AND_DROP=False
FEATURE_TAB_MODE=False

# ============================================================================
# AI ASSISTANT CONFIGURATION
# ============================================================================
DIFY_API_KEY=your_dify_api_key_here
DIFY_API_URL=http://101.42.231.179/v1
DIFY_TIMEOUT=30
AI_ASSISTANT_NAME=教学设计

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
DATABASE_URL=sqlite:///./data/mindgraph.db

# Database Connection Pool Configuration
# SQLite defaults: pool_size=15, max_overflow=30
# PostgreSQL/MySQL defaults: pool_size=30, max_overflow=60
# DATABASE_POOL_SIZE=15
# DATABASE_MAX_OVERFLOW=30
# DATABASE_POOL_TIMEOUT=30

# ============================================================================
# TOKEN TRACKING CONFIGURATION
# ============================================================================
TOKEN_TRACKER_ENABLED=true
TOKEN_TRACKER_BATCH_SIZE=1000
TOKEN_TRACKER_BATCH_INTERVAL=300
TOKEN_TRACKER_MAX_BUFFER_SIZE=10000

# ============================================================================
# DATABASE BACKUP CONFIGURATION
# ============================================================================
BACKUP_ENABLED=true
BACKUP_HOUR=3
BACKUP_RETENTION_COUNT=2
BACKUP_DIR=backup

# ============================================================================
# TENCENT CLOUD OBJECT STORAGE (COS) CONFIGURATION (Optional)
# ============================================================================
# Register at: https://console.cloud.tencent.com/cos5
COS_BACKUP_ENABLED=false
COS_BUCKET=your-bucket-name-appid
COS_REGION=ap-beijing
COS_KEY_PREFIX=backups/mindgraph-CHANGE

# ============================================================================
# AUTHENTICATION & SECURITY CONFIGURATION
# ============================================================================
# Generate secure key: python -c "import secrets; print(secrets.token_urlsafe(48))"
JWT_SECRET_KEY=QwWZfgwi-ct3rBdWyhoXa7S5mzHuC6yaGgmzGC_-1qSMl4H-879Ng4jZIq1cBSR7
JWT_EXPIRY_HOURS=24

# Auth modes: standard, enterprise, demo, bayi
AUTH_MODE=standard
# Admin phone numbers (comma-separated)
# ADMIN_PHONES=13812345678,13987654321
ADMIN_PHONES=

# Enterprise Mode (only if AUTH_MODE=enterprise)
ENTERPRISE_DEFAULT_ORG_CODE=DEMO-001
ENTERPRISE_DEFAULT_USER_PHONE=enterprise@system.com

# Demo Mode (only if AUTH_MODE=demo)
DEMO_PASSKEY=888888
ADMIN_DEMO_PASSKEY=999999

# Bayi Mode (only if AUTH_MODE=bayi)
BAYI_DECRYPTION_KEY=v8IT7XujLPsM7FYuDPRhPtZk
BAYI_DEFAULT_ORG_CODE=BAYI-001
BAYI_CLOCK_SKEW_TOLERANCE=10
BAYI_IP_WHITELIST=

# Invitation Codes: Format AAAA-XXXXX
# Internal format: ORG_CODE:INVITATION_CODE:EXPIRY_DATE
INVITATION_CODES=DEMO-001:DEMO-A1B2C:never

# ============================================================================
# TENCENT CLOUD SMS CONFIGURATION (Optional)
# ============================================================================
# Register at: https://console.cloud.tencent.com/smsv2
TENCENT_SMS_SECRET_ID=your-tencent-secret-id-here
TENCENT_SMS_SECRET_KEY=your-tencent-secret-key-here
TENCENT_SMS_SDK_APP_ID=1400000000
TENCENT_SMS_SIGN_NAME=MindGraph
TENCENT_SMS_REGION=ap-guangzhou
TENCENT_SMS_TEMPLATE_REGISTER=1234567
TENCENT_SMS_TEMPLATE_LOGIN=1234568
TENCENT_SMS_TEMPLATE_RESET_PASSWORD=1234569

SMS_CODE_EXPIRY_MINUTES=5
SMS_RESEND_INTERVAL_SECONDS=60
SMS_MAX_ATTEMPTS_PER_PHONE=5
SMS_MAX_ATTEMPTS_WINDOW_HOURS=1
SMS_MAX_CONCURRENT_REQUESTS=10
SMS_QPM_LIMIT=100
SMS_RATE_LIMITING_ENABLED=true

# ============================================================================
# REDIS CONFIGURATION (REQUIRED)
# ============================================================================
# MindGraph uses SQLite + Redis architecture
# Redis is REQUIRED. Application will NOT start without Redis.

REDIS_URL=redis://localhost:6379/0

# Connection pool settings (optional)
# REDIS_MAX_CONNECTIONS=50
# REDIS_SOCKET_TIMEOUT=5

# ============================================================================
# EXTERNAL SERVICES CONFIGURATION
# ============================================================================
WECHAT_QR_IMAGE=
