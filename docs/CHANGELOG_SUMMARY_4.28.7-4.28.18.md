# 更新日志摘要 (版本 4.28.7 - 4.28.18)

## 4.28.18 - 视图适配改进

- 修复点击节点时视图重置问题，保留缩放和平移状态
- 修复节点选择时调用错误的适配方法
- 优化视图适配逻辑，避免不必要的动画
- 改进面板变化处理，统一使用事件总线
- 优化属性面板显示/隐藏逻辑

## 4.28.17 - Token 计数准确性修复

- 修复 Token 计数不准确问题，使用 API 权威值而非简单相加
- TokenTracker 优先使用 API 提供的 total_tokens
- LLMService 和 Voice Router 正确提取并传递 total_tokens
- 确保 Token 计数与 API 计费完全一致

## 4.28.16 - .env 文件编码修复

- 修复 Windows 下 .env 文件非 UTF-8 编码导致的启动错误
- 自动检测并转换 .env 文件编码为 UTF-8
- 转换前自动创建备份文件
- 支持多种编码格式检测（UTF-16, CP1252, GBK 等）

## 4.28.15 - 数据库位置冲突安全检查

- 添加数据库位置冲突检测功能
- 检测根目录和 data/ 文件夹中同时存在数据库文件的情况
- 应用启动时拒绝启动并提供清晰的错误信息
- 提供详细的解决步骤说明

## 4.28.14 - 重置样式修复和代码重构

- 修复气泡图中重置样式应用错误默认值的问题
- 每个节点类型现在正确重置到各自的模板默认值
- 提取 applyPropertiesToNode() 辅助方法，消除代码重复
- 改进重置样式实现，添加颜色标准化和空值检查

## 4.28.13 - 清空按钮尺寸保留和属性面板空间支持

- 清空按钮现在保留节点尺寸（宽度/高度或半径）
- 属性面板文本输入保留前导和尾随空格
- 支持所有图表类型（矩形和圆形）
- 尺寸存储在内存中，在重新渲染后自动恢复

## 4.28.12 - Token 跟踪标签页和八一模式管理员访问

- 添加 Token 跟踪标签页，显示今日/本周/本月/总计统计
- 显示前 10 名用户排行榜
- 添加 Token 统计 API 端点
- 更新仪表板显示总 Token 使用量
- 支持八一模式管理员访问

## 4.28.11 - 设置脚本组织和目录管理

- 自动创建应用所需目录（static/images/, tests/images/, temp_images/）
- 自动创建 data/ 目录用于数据库文件
- 将 setup.py 移动到 scripts/ 目录
- 简化路径解析逻辑

## 4.28.10 - 数据库路径迁移和组织

- 自动将数据库从根目录迁移到 data/ 文件夹
- 迁移所有 SQLite 文件（db, wal, shm）
- 更新默认数据库路径为 ./data/mindgraph.db
- 备份脚本现在动态读取数据库路径
- 改进 SQLite URL 解析

## 4.28.9 - 验证码存储多工作进程修复

- 修复多服务器实例导致的间歇性登录失败
- 添加端口可用性检查，防止多个 uvicorn 实例
- 实现混合存储（内存缓存 + 文件持久化）
- 添加跨进程文件锁定支持
- 验证后立即删除文件，防止验证码重用

## 4.28.8 - 配置文件整合

- 合并 uvicorn_log_config.py 和 uvicorn.conf.py 为单个 uvicorn_config.py
- 统一服务器配置和日志配置
- 简化配置管理

## 4.28.7 - 反馈按钮和 UI 改进

- 添加反馈按钮，显示微信二维码模态框
- 反馈按钮支持双语显示（中英文）
- 添加彩虹发光动画效果
- 修复退出按钮翻译问题
- 修复 Windows Proactor 错误过滤问题
- 统一动画命名规范

